# 代码审查观点与最佳实践

## 目录
- [变量自描述#A](#A)
- [样式#B](#B)
- [逻辑可读性#C](#C)
- [逻辑缺陷#D](#D)
- [ES6+ 应用#E](#E)
- [ESlint 校验#F](#F)
- [性能#G](#G)

# <span id='A'>变量自描述#A</span>
----

## 观点#01

**描述**

- 条件判断存在硬编码，无法直观表达业务含义

**最佳实践**

- 采用（枚举）对象结合注释的方式，明确数值、字符串的业务含义

**示例1**
> 来自郭宏博

<font color=#FD4147>:-1: Bad</font>

```js
isFees() {
  return store.getters['account/getInfo'].is_fees === 2
}
```
<font color=#00D09B>:+1: Good</font>

```js
const ACCOUNT_TYPE = {
  // 测试账号
  TEST: 0,
  // 试用账户
  TRIAL: 1,
  // 付费账户
  PAID: 2,
  // 商机账户
  BUSINESS: 3,
  // 免费账号
  FREE: 4,
}

isFees() {
  return store.getters['account/getInfo'].is_fees === ACCOUNT_TYPE.PAID
}
```

**示例2**
> 来自张雪

<font color=#FD4147>:-1: Bad</font>

```js
<fz-checkbox item" value="8">
    {{ $t('min_number') }}
</fz-checkbox>
```

<font color=#00D09B>:+1: Good</font>

```js
<fz-checkbox item" value="TIPS.REGIONAL_LONG_TIME">
    {{ $t('min_number') }}
</fz-checkbox>

const TIPS = Object.freeze({
  // 同时选择异地登录提醒和长时间未登录（30天）
  REGIONAL_LONG_TIME: '8',
  // 同时选择异地登录提醒和不在以下ip范围内
  REGIONAL_IP: '18',
  // 同时选择长时间未登录（30天）和 不在以下IP范围
  LONG_TIME_IP: '22',
  // 同时选择长时间未登录（30天）、异地登录提醒 和 不在以下IP范围
  REGIONAL_LONG_TIME_IP: '24',
})
```


## 观点#02
**描述**

- 条件判断存在硬编码，不易逻辑扩展和维护

**最佳实践**

- 声明常量，避免直接使用硬编码

**示例**
> 来自赵黎明

<font color=#FD4147>:-1: Bad</font>

```js
if(error.code === 'file is locked by user'){
    ...
}
```

<font color=#00D09B>:+1: Good</font>

```js
const fileIsLocked = 'file is locked by user'
if(error.code === fileIsLocked){
    ...
}
```

## 观点#03
**描述**
- 不同用途变量命名重复，产生理解歧义，减低了可读性

**最佳实践**
- 根据变量用途进行命名

**示例**
> 来自王祎

<font color=#FD4147>:-1: Bad</font>

```html
<fzx-tabs default-active-key="activated">
    <fz-tab-pane key="activated" :tab="$t('activated')">
    </fz-tab-pane>    
</fzx-tabs>
```

<font color=#00D09B>:+1: Good</font>

```html
<fzx-tabs default-active-key="openServer">
    <fz-tab-pane key="openServer" :tab="$t('activated')">
    </fz-tab-pane>    
</fzx-tabs>
```

## 观点#04
**描述**

- 变量名命名与术语或专有名词不一致，产生理解歧义

**最佳实践**

- 使用术语或专有名词进行命名

**示例**
> 来自巩凡淑

<font color=#FD4147>:-1: Bad</font>

```js
// verification代表图形验证码
// code代表短信验证码
```

<font color=#00D09B>:+1: Good</font>

```js
// captcha代表图形验证码
// verificationCode代表短信验证码
```

## 观点#05
**描述**

- 布尔类型变量命名不符合约定

**最佳实践**

- 遵循布尔类型变量命名约定：

  增加前缀，如 *is*，*are*，或 *has* 的做法，能够帮助 JavaScript 开发者，将布尔类型变量与其他类型变量进行明确区分，达到一望便知的效果。

**示例**
> 来自赵黎明

<font color=#FD4147>:-1: Bad</font>

```js
this.move = fasle
```

<font color=#00D09B>:+1: Good</font>

```
this.isConfirmMove = false
```

# <span id='B'>样式表#B</span>

## 观点#01
**描述**

- 未使用 less 语法
- 类名语义模糊，易重复

**最佳实践**

- 使用 less 语法书写样式表
- 类名命名增强业务含义

**示例1**
> 来自郭宏博

<font color=#FD4147>:-1: Bad</font>
```css
.column-panel {
  margin-bottom: 24px;
}
.content {
  display: flex;
}
.content-left {
  flex: 1;
  padding-right: 24px;
}
.content-right {
  margin-right: 101px;
}
.cancel-button {
  color: #0a64fa;
}
```

<font color=#00D09B>:+1: Good</font>

```css
.column-panel {
  margin-bottom: 24px;
  .account-cancel-content {
    display: flex;
    .cancel-description {
      flex: 1;
      padding-right: 24px;
    }
    .cancel-entry {
      margin-right: 101px;
      .cancel-button {
        color: #0a64fa;
      }
    }
  }
}
```

**示例2**
> 来自赵黎明

<font color=#FD4147>:-1: Bad</font>

```css
.more-func{
  ...
}
```

<font color=#00D09B>:+1: Good</font>

```css
.show-special-file{
  ...
}
```

## 观点#02
**描述**
- 使用行内样式，降低了可维护性、复用性

**最佳实践**
- 使用内部样式

**示例**
> 来自王祎

<font color=#FD4147>:-1: Bad</font>
```html
<div style="margin-bottom: 10px;color: #929ca9;">{{$t('extra_feature_title') }}</div>
```

<font color=#00D09B>:+1: Good</font>
```html
<div class="guidance-prompt">{{$t('extra_feature_title') }}</div>
``` 
```css
.guidance-prompt {
  margin-bottom: 10px;
  color: #929ca9;
}
```

# <span id='C'>逻辑可读性#C</span>
----

## 观点#01
**描述**
- 字符串拼接 HTML 未进行格式化，降低了可读性

**最佳实践**

- 进行换行、缩进格式化处理，提升可读性

**示例**
> 来自陈阳

<font color=#FD4147>:-1: Bad</font>
```javascript
recoveryTips = '<div class="recovery-tips clearfix">'+ '<i class="ico-tips"></i><p>' + (e.canMove ? _('当前选择为该文件(夹)的原路径') : _('当前文件(夹)无法恢复至原路径，请选择指定位置')) +'</p></div>'
```
<font color=#00D09B>:+1: Good</font>

```javascript
 recoveryTips = 
    '<div class="recovery-tips clearfix">' +
        '<i class="ico-tips"></i>' +
        '<p>' +
            e.canMove ? _('当前选择为该文件(夹)的原路径') : _('当前文件(夹)无法恢复至原路径，请选择指定位置') +
        '</p>' +
    '</div>'
```

## 观点#02？？
**描述**

- 函数放的比较混乱，不易于理解业务

**最佳实践**

- 将业务逻辑代码放在前边，交互、工具类的函数放在后边，便于后期维护代码

**示例**
> 来自巩凡淑

<font color=#FD4147>:-1: Bad</font>

```js
methods:{
  // 微信登录相关
  // 交互
  // 微信登录相关
  wechatMethod(){...}
  // 交互
  // 验证码接口
  sendCode(){...}
  // 验证码参数处理
  // 点击验证码
  sendVerification(){...}
  // 提交表单
  submit(){...}
  // 登录接口
  outUserLogin(){...}
  // 校验方法
}
```

<font color=#00D09B>:+1: Good</font>

```js
methods:{
  // 点击发送验证码
  changeVerMethod(){
    // 校验数据
    // 处理请求参数
    // 请求接口并进行防抖处理
    // 处理错误信息展示
  }
  // 提交表单
  submit(){
    // 校验数据
    // 处理请求参数
    // 请求接口并进行防抖处理
    // 处理错误信息展示
  }
  /*微信二维码登录相关函数*/
  wechatMethod(){...}
  ...
  // 交互、工具类函数
}
```

## 观点#11

**描述**

- 逻辑片段无法直观表达业务含义，且具备原子性

**最佳实践**

- 使用计算属性增强自描述性、扩展性

**示例**
> 来自巩凡淑

<font color=#FD4147>:-1: Bad</font>

```js
this.authMode === 'phone'
```

<font color=#00D09B>:+1: Good</font>

```js
computed: {
    ...
  isPhone() {
    return this.authMode === 'phone'
  },
},
```

## 观点#12

**描述**

- 在 data 中声明属性，通过 methods 实现复杂逻辑并对属性进行赋值，达到控制其他逻辑的目的

**最佳实践**

- 将复杂逻辑包装为计算属性，代替在 data 中声明属性，增强逻辑自描述性、扩展性，简化代码

**示例**
> 来自张雪

<font color=#FD4147>:-1: Bad</font>

```js
data: () => {
  ValidateStatus: true,
  ...
}

methods: {
  checkValidation() {
    this.ValidateStatus = true
    const pattern = /^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){4}$/
    if (!pattern.test(this.ipList.startIp) || !pattern.test(this.ipList.endIp)) {
      this.ValidateStatus = false
    }
  },
}
```

<font color=#00D09B>:+1: Good</font>

```js
computed: {
  validationable() {
    const pattern = /^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){4}$/
    if (!pattern.test(this.ipList.startIp) || !pattern.test(this.ipList.endIp)) {
      return false
    }
    return true
  },
}
```

## 观点#21
**描述**

- 迭代过程中，代码越写越长，难以维护

**最佳实践**

- 将函数剥离出来，关注分离

<font color=#FD4147>:-1: Bad</font>

```js
this.$confirm({
  ...
  onOk: async () => {
    const { _id: accountId } = store.state.account.info
    await store.dispatch('axios', {
      method: 'post',
      url: `/v2/account/unregistry/create?account_id=${accountId}`,
      formData: params,
    })
    this.callbackResolve(false)
  },
})  
```

<font color=#00D09B>:+1: Good</font>

```js
this.$confirm({
  ...
  onOk: this.unregistryHandler
})
async unregistryHandler( ){
  const { _id: accountId } = store.state.account.info
  await store.dispatch('axios', {
    method: 'post',
    url: `/v2/account/unregistry/create?account_id=${accountId}`,
    formData: params,
  })
  this.callbackResolve(false)
}
```

## 观点#22
**描述**

- 在条件语句中定义表格列数组，代码冗余，降低了可读性

**最佳实践**

- 在 data 中定义表格列数组全集，初始化时对数组元素进行裁剪，直观体现差异，提升可读性。

**示例**
> 来自张雪

<font color=#FD4147>:-1: Bad</font>

```js
created(){
    if (this.accountSession.accountManageMode === 'enterprise') {
      this.memberColumns = [
        {
          title: this.$t('user_name'),
          dataIndex: 'user_name',
          scopedSlots: { customRender: 'user_name' },
          width: '25%',
        },
        {
          title: this.$t('belong_team'),
          dataIndex: 'belongTeam',
          scopedSlots: { customRender: 'belongTeam' },
          width: '25%',
        },
        { ... }，
        { ... }，
        ...
      ]
    } else {
      this.memberColumns = [
        {
          title: this.$t('user_name'),
          dataIndex: 'user_name',
          scopedSlots: { customRender: 'user_name' },
          width: '25%',
        },
        {
          title: this.$t('belong_org'),
          dataIndex: 'belongOrg',
          scopedSlots: { customRender: 'belongOrg' },
          width: '25%',
        },
        { ... }，
        { ... }，
        ...
      ]
    }
}
```

<font color=#00D09B>:+1: Good</font>

```js
data(){
  return {
    memberColumns: [
    	{ ... },
        {
          title: this.$t('belong_team'),
          dataIndex: 'belongTeam',
          scopedSlots: { customRender: 'belongTeam' },
          width: '25%',
        },
        {
          title: this.$t('belong_org'),
          dataIndex: 'belongOrg',
          scopedSlots: { customRender: 'belongOrg' },
          width: '25%',
        },
        { ... }，
    ]
  }
},
created(){
    if (this.accountSession.accountManageMode !== 'enterprise') {
      this.memberColumns.splice(2, 1)
    }
}
```

## 观点#23
**描述**
- 未对数据源进行结构化处理，使用大量条件判断，降低了可扩展性、可读性

**最佳实践**
- 对数据源进行结构化处理，使用数组 API 代替条件判断，提升扩展性、可读性

**示例**
> 来自王祎

<font color=#FD4147>:-1: Bad</font>

```js
const USER_TYPES = { orgs: 2, teams: 3, groups: 4, users: 5 }
iconType(data) {
  if (data.targetType === USER_TYPES.users) {
    return userIcon
  } else if (data.targetType === USER_TYPES.orgs) {
    return orgIcon
  } else if (data.targetType === USER_TYPES.teams) {
    return teamIcon
  } else if (data.targetType === USER_TYPES.groups) {
    return groupIcon
  }
  return null
},
```

<font color=#00D09B>:+1: Good</font>

```js
const USER_TYPES = [
  { id: 2, icon: orgIcon },
  { id: 3, icon: teamIcon },
  { id: 4, icon: groupIcon },
  { id: 5, icon: userIcon },
]

iconType(targetType) {
  const userType = USER_TYPES.find(item => item.id === targetType)
  return userType ? userType.icon : null
},
```

## 观点10-巩凡淑？？
**描述**

- 代码不够简洁

**最佳实践**

- 尽量用少的代码来实现

<font color=#FD4147>:-1: Bad</font>

```js
validForm() {
  if (this.captchaShow && !this.validCaptcha()) {
    return false
  }
  if (!this.validAccount()) {
    return false
  }
  return true
},
```

<font color=#00D09B>:+1: Good</font>

```js
validForm() {
  return !((this.captchaShow && !this.validCaptcha()) || !this.validAccount())
},
```

# <span id='D'>逻辑缺陷#D</span>
----

## 观点#01
**描述**

- 对布尔类型变量赋值时错误地使用三元运算符

**最佳实践**

- 直接赋值

**示例**
> 来自陈阳

<font color=#FD4147>:-1: Bad</font>
```javascript
this.autoOpen = autoOpen === false ? false : true
```
<font color=#00D09B>:+1: Good</font>

```javascript
this.autoOpen = autoOpen
```

## 观点#02
**描述**

- 单位相同时，错误使用 calc 函数

**最佳实践**

- 单位相同时，直接使用计算后的结果

**示例**
> 来自郭宏博

<font color=#FD4147>:-1: Bad</font>

```css
.content-right {
  margin-right: calc(125px - 24px);
}
```

<font color=#00D09B>:+1: Good</font>

```css
.cancel-right {
    margin-right: 101px;
}
```

## 观点#11
**描述**

- 在单页面应用中使用 window.location.reload() 方法刷新页面

**最佳实践**

- 使用组件通信，在父组件中重新调接口获取信息

**示例**
> 来自赵黎明

<font color=#FD4147>:-1: Bad</font>

```js
async receiveRetry() {
  ...
  const ret = await API.receiveRetry(params)
  if (ret.data.code === 200) {
    ...
    window.location.reload()
  } else {
    ...
  }
},
```

<font color=#00D09B>:+1: Good</font>

```js
async receiveRetry() {
  ...
  const ret = await API.receiveRetry(params)
  if (ret.data.code === 200) {
    ...
    this.$emit('initFerryInfo')
  } else {
    ...
  }
},
```

## 观点#12
**描述**

- 使用代码逻辑处理包含变量的多语言场景

**最佳实践**

- 使用 i18n 占位符处理

**示例**
> 来自赵黎明

<font color=#FD4147>:-1: Bad</font>

```js
function i18n () {
  ...
  return isZh ?
    operator + '重新获取摆渡文件，流水号为' + number :
    'The ' + operator + ' retrieves the exchange documents, and the serial number is' + number;
}
```

<font color=#00D09B>:+1: Good</font>

```js
function i18n () {
  ...
  return _('{0}重新获取摆渡文件，流水号为{1}', operator, number)
}
```

## 观点#13
**描述**

- 项目迭代过程，由于不同开发人员的编写习惯，导致用法不统一

**最佳实践**
- 与已有写法保持一致，如需要优化，要进行统一调整。

**示例**
> 来自郭宏博

<font color=#FD4147>:-1: Bad</font>

```js
import store from '@/store'
...
export default {
  computed: {
    isEnt() {
      return this.$store.state.account.session.accountManageMode === 'enterprise'
    },
    
    isFees() {
      return store.getters['account/getInfo'].is_fees
    }
  }
}
```

<font color=#00D09B>:+1: Good</font>

```js
import store from '@/store'
...
export default {
  computed: {
    isEnt() {
      return store.state.account.session.accountManageMode === 'enterprise'
    },

    isFees() {
      return store.getters['account/getInfo'].is_fees
    }
  }
}
```

## 观点#31？？
**描述**

- 未做防抖处理，在短时间内多次点击发送多次请求

**最佳实践**

- 对交互动作进行防抖处理

**示例**
> 来自巩凡淑

<font color=#FD4147>:-1: Bad</font>

```js
postData('url', params)
  .then(() => {
    ...
})
```

<font color=#00D09B>:+1: Good</font>

```js
debounce(fn, delay = 400) {
  const vm = this
  clearTimeout(this.timer)
  this.timer = setTimeout(() => {
    fn.call(vm)
  }, delay)
},
debounce(function(){
  postData('url', params)
    .then(() => {
      ...
  })
})
```

## 观点#32
**描述**

- 处理网络请求时额外添加异常处理逻辑，导致统一处理异常捕获的代码逻辑失效，用法不规范，且对阅读代码的研发人员产生误导
-  Request Headers 添加了冗余参数

**最佳实践**

- 项目中对网络请求的异常情况进行了统一异常捕获处理，当统一异常处理无法满足业务场景时，再单独进行异常处理。
- 删除多余的 headers 参数

**示例**
> 来自郭宏博

<font color=#FD4147>:-1: Bad</font>

```js
const res = await store
  .dispatch('axios', {
    method: 'post',
    url: `/v2/account/unregistry/create?account_id=${accountId}`,
    formData: params,
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
  })
  .catch(err => err.response)
  if (res.data.code !== 200) {
    return
  }
```

<font color=#00D09B>:+1: Good</font>

```js
await store.dispatch('axios', {
  method: 'post',
  url: `/v2/account/unregistry/create?account_id=${accountId}`,
  formData: params,
})
```

# <span id='E'>ES6+ 应用#E</span>
----

## 观点#01
**描述**

- 合并数组使用 ES5 concat 方法

**最佳实践**

- 使用 ES6 扩展运算符操作数组，可读性更好

**示例**
> 来自张雪

<font color=#FD4147>:-1: Bad</font>

```js
memberList() {
     return this.orgs.concat(this.teams).concat(this.users).concat(this.groups)
},
```

<font color=#00D09B>:+1: Good</font>

```js
memberList() {
     return [...this.team, ...this.user, ...this.org, ...this.group]
},
```

## 观点#02
**描述**

- 使用数组下标取值，降低了可扩展性

**最佳实践**

- 使用 ES6 数组解构赋值，可灵活扩展数据源

**示例**
> 来自张雪

<font color=#FD4147>:-1: Bad</font>

```js
async getTransferAuthList(controlMembers) {
  this.teams = controlMembers[0]
  this.groups = controlMembers[3]
  const newControlMembers = await this.getBelongTeams(controlMembers)
  this.orgs = newControlMembers[1]
  this.users = newControlMembers[0]
},
const arr = [teamArr, groupArr, userArr, orgArr]
this.getTransferAuthList(arr)
  
```

<font color=#00D09B>:+1: Good</font>

```js
async getTransferAuthList(controlMembers) {
  const [team, group] = controlMembers
  this.team = team
  this.group = group
  const [user, org] = await this.getBelongTeams(controlMembers)
  this.org = org
  this.user = user
},
```

## 观点#03
**描述**
- 使用引号拼接字符串，降低了可读性

**最佳实践**
- 使用模板字符串，提升可读性、可扩展性

**示例**
> 来自王祎

<font color=#FD4147>:-1: Bad</font>
```html
<span>{{ isExpire ? '(' + $t('expire_prompt') + ')' : '' }}</span>
```
<font color=#00D09B>:+1: Good</font>
```html
<span >{{ isExpire ? `(${$t('expire_prompt')})` : '' }}</span>
```

# <span id='F'>ESlint 校验#F</span>

## 观点#01
**描述**

- 接口返回的变量命名包含下划线，无法通过 eslint 校验，采用了关闭文件级别的 eslint 校验来处理

**最佳实践**

- 不能通过随意关闭 eslint 规则的方式绕过 eslint 检查
- 采用解构赋值的方式将变量进行重命名

**示例**
> 来自郭宏博

<font color=#FD4147>:-1: Bad</font>

```js
<script>
// eslint-disable no-underscore-dangle
...
export default {
  methods: {
    func() {
      await store.dispatch('axios', {
        method: 'get',
        url: `/v2/account/unregistry/cancel`,
        params: {
          account_id: store.state.account.info._id,
        }
      })
    }
  }
}
</script>
```

<font color=#00D09B>:+1: Good</font>

```js
export default {
  methods: {
    func() {
      const { _id: accountId } = store.state.account.info
      await store.dispatch('axios', {
        method: 'get',
        url: `/v2/account/unregistry/cancel`,
        params: {
          account_id: accountId,
        },
      })
  }
  }
}
```

# <span id='G'>性能#G</span>
----
## 观点#01

**描述**

- v-if/v-else 操作会增加性能开销

**最佳实践**

- 减少 v-if/v-else 操作，使用样式切换状态代替 DOM 切换

**示例**
> 来自巩凡淑

<font color=#FD4147>:-1: Bad</font>

```html
<div class="countDownBtn countDown-disable" v-if="second">
    {{ $t('重新获取') }} {{ second }}s
</div>
<div class="countDownBtn" v-else @click="verificationCodeClick">
	{{ $t('获取验证码') }}
</div>
```

<font color=#00D09B>:+1: Good</font>

```html
<div :class="['countDownBtn', { 'countDown-disable': second }]" @click="verificationCodeClick">
    {{ second ? $t('重新获取') + ` ${second}s` : $t('获取验证码') }}
</div>
```

